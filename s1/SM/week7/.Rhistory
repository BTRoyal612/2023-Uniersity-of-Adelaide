X2 <- model.matrix(difference ~ Away.Team, data=new_df)
X <- (X1-X2)[,-1]
M <- lm(new_df$difference ~ X)
summary(M)
plot(M)
y <- new_df$difference
M <- lm(y ~ X)
summary(M)
plot(M)
y <- new_df$difference
M <- lm(y ~ X)
plot(M$fitted.values, M$residuals,
xlab = "Fitted values", ylab = "Residuals",
main = "Residuals vs. Fitted Plot")
abline(h = 0, lty = 2)
mtext("Residuals vs Fitted plot")
plot(M$fitted.values, M$residuals,
xlab = "Fitted values", ylab = "Residuals",
main = "Residuals vs. Fitted Plot")
abline(h = 0, lty = 2)
title("Figure 1. Residuals vs. Fitted Plot for Linear Regression Model",
line = -1, cex.main = 1.2)
mtext("The residuals appear randomly scattered around 0, indicating that the linear regression model is a good fit for the data.",
side = 1, line = 4)
plot(M)
plot(M)[0]
plot(M, which=1)
plot(M, which=1)
mtext("This plot shows the relationship between the strength of home and away teams and the difference in score. The red line represents the mean score difference value.", side = 1, line = 3)
plot(M, which=1)
mtext("This plot shows the relationship between the strength of home and away teams and the difference in score. The red line represents the mean score difference value.", side = 0.1, line = 3)
plot(M, which=1)
mtext("This plot shows the relationship between the strength of home and away teams and the difference in score. The red line represents the mean score difference value.", side = 1.5, line = 3)
plot(M, which=1)
mtext("This plot shows the relationship between the strength of home and away teams and the difference in score. The red line represents the mean score difference value.", side = 1, line = 2)
plot(M, which=1)
mtext("This plot shows the relationship between the strength of home and away teams and the difference in score. The red line represents the mean score difference value.", side = 1, line = 5)
plot(M, which=1)
mtext("This plot shows the relationship between the strength of home and away teams and the difference in score. The red line represents the mean score difference value.", side = 1, line = 4)
plot(M, which=2)
mtext("This plot shows a normal quantile plot of 198 random samples from a standard normal distribution. The red line represents the expected quantiles if the data were normally distributed.", side = 1, line = 3)
x0 <- c(1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
predict(M, newdata=x0)
x0 <- tibble(c(1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0))
predict(M, newdata=x0)
x0 <- c(1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)
predict(M, newdata=x0)
x0 <- data.frame(c(1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0))
x0 <- data.frame(c(1,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0))
predict(M, newdata=x0)
y0 <- 3.682 + 12.892 - (-14.758)
y0
knitr::opts_chunk$set(
echo = TRUE,
fig.width = 6,
fig.asp = 0.618,
out.width = "70%",
fig.align = "center",
root.dir = "../"
)
pacman::p_load(tidyverse, tidymodels)
df <- read.csv("AFL2019.csv")
df <- df %>%
mutate(
Home.Team=as.factor(Home.Team),
Away.Team=as.factor(Away.Team)
)
AFL_teams_2019 <- unique(df$Home.Team)
AFL_teams_2019
new_df <- df %>%
mutate(difference = Home.Score - Away.Score)
head(new_df)
X1 <- model.matrix(difference ~ Home.Team, data=new_df)
X2 <- model.matrix(difference ~ Away.Team, data=new_df)
X <- (X1-X2)[,-1]
y <- new_df$difference
M <- lm(y ~ X)
par(mar = c(9, 5, 2, 3))
plot(M, which=1)
mtext("This plot shows the relationship between the strength of home and away
teams and the difference in score. The red line represents the mean score
difference value.", side = 1, line = 8)
par(mar = c(9, 5, 2, 3))
plot(M, which=2)
mtext("This plot shows a normal quantile plot of 198 random samples from a
standard normal distribution. The red line represents the expected
quantiles if the data were normally distributed.", side = 1, line = 8)
broom::tidy(M)
broom::glance(M)
y0 <- 3.682 + 12.892 - (-14.758)
y0
knitr::opts_chunk$set(
echo = TRUE,
fig.width = 6,
fig.asp = 0.618,
out.width = "70%",
fig.align = "center",
root.dir = "../"
)
pacman::p_load(tidyverse, gglm, skimr, MASS)
data <- read_delim(("companies.txt"), delim = "\t")
data
data <- data %>%
mutate(Employees = as.numeric(Employees))
skim(data)
data %>%
ggplot(aes(MarketValue)) +
geom_histogram(col = "black", fill = "orange") +
ggtitle("Histogram of the MarketValue")
data %>%
ggplot(aes(Assets, MarketValue)) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Assets")
data %>%
ggplot(aes(Sales, MarketValue)) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Sales")
data %>%
ggplot(aes(Profits, MarketValue)) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Profits")
data %>%
ggplot(aes(CashFlow, MarketValue)) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs CashFlow")
data %>%
ggplot(aes(Employees, MarketValue)) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Employees")
data %>%
ggplot(aes(log(Assets), log(MarketValue))) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Assets on a log scale")
data %>%
ggplot(aes(log(Sales), log(MarketValue))) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Sales on a log scale")
data %>%
ggplot(aes(log(Profits), log(MarketValue))) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Profits on a log scale")
data %>%
ggplot(aes(log(CashFlow), log(MarketValue))) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs CashFlow on a log scale")
data %>%
ggplot(aes(log(Employees), log(MarketValue))) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Employees on a log scale")
M1 <- lm(MarketValue ~ log(Assets) + log(Sales) + Profits + CashFlow + log(Employees), data=data)
summary(M1)
gglm(M1)
boxcox(M1, lambda=seq(0, 0.5, by=0.1))
bc <- boxcox(M1)
bc
lambda <- bc$x[which.max(bc$y)]
lambda2 <- 0.2
M2 <- lm(((MarketValue^lambda - 1)/lambda) ~ log(Assets) + log(Sales) + Profits + CashFlow + log(Employees), data=data)
summary(M2)
M3 <- lm(((MarketValue^lambda2 - 1)/lambda2) ~ log(Assets) + log(Sales) + Profits + CashFlow + log(Employees), data=data)
summary(M3)
gglm(M2)
gglm(M3)
new_company <- tibble(
Assets = 1065,
Sales = 642,
Profits = 30,
CashFlow = 59,
Employees = 3.5
)
transform_pred <- predict(M2, newdata=new_company, interval="prediction", level=0.95)
market_pred <- exp(log(transform_pred*lambda + 1)/lambda)
market_pred
transform_pred2 <- predict(M3, newdata=new_company, interval="prediction", level=0.95)
market_pred2 <- exp(log(transform_pred*lambda2 + 1)/lambda2)
market_pred2
knitr::opts_chunk$set(
echo = TRUE,
fig.width = 6,
fig.asp = 0.618,
out.width = "70%",
fig.align = "center",
root.dir = "../"
)
pacman::p_load(tidyverse, gglm, skimr, MASS)
data <- read_delim(("companies.txt"), delim = "\t")
data
data <- data %>%
mutate(Employees = as.numeric(Employees))
skim(data)
data %>%
ggplot(aes(MarketValue)) +
geom_histogram(col = "black", fill = "orange") +
ggtitle("Histogram of the MarketValue")
data %>%
ggplot(aes(Assets, MarketValue)) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Assets")
data %>%
ggplot(aes(Sales, MarketValue)) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Sales")
data %>%
ggplot(aes(Profits, MarketValue)) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Profits")
data %>%
ggplot(aes(CashFlow, MarketValue)) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs CashFlow")
data %>%
ggplot(aes(Employees, MarketValue)) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Employees")
data %>%
ggplot(aes(log(Assets), log(MarketValue))) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Assets on a log scale")
data %>%
ggplot(aes(log(Sales), log(MarketValue))) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Sales on a log scale")
data %>%
ggplot(aes(log(Profits), log(MarketValue))) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Profits on a log scale")
data %>%
ggplot(aes(log(CashFlow), log(MarketValue))) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs CashFlow on a log scale")
data %>%
ggplot(aes(log(Employees), log(MarketValue))) +
geom_point() +
ggtitle("Scatterplot of MarketValue vs Employees on a log scale")
M1 <- lm(MarketValue ~ log(Assets) + log(Sales) + Profits + CashFlow + log(Employees), data=data)
summary(M1)
gglm(M1)
bc <- boxcox(M1)
bc
lambda <- bc$x[which.max(bc$y)]
lambda
M2 <- lm(((MarketValue^lambda - 1)/lambda) ~ log(Assets) + log(Sales) + Profits + CashFlow + log(Employees), data=data)
summary(M2)
gglm(M2)
new_company <- tibble(
Assets = 1065,
Sales = 642,
Profits = 30,
CashFlow = 59,
Employees = 3.5
)
transform_pred <- predict(M2, newdata=new_company, interval="prediction", level=0.95)
market_pred <- exp(log(transform_pred*lambda + 1)/lambda)
market_pred
x <- seq(1,10, by = 1)
y <- c(1.7, 5.56, 8.96, 9.74, 13.1, 15.0, 15.8, 16.9, 18.4, 23.1)X <- cbind(x,y)
x <- seq(1,10, by = 1)
y <- c(1.7, 5.56, 8.96, 9.74, 13.1, 15.0, 15.8, 16.9, 18.4, 23.1)
X <- cbind(x,y)
H <- X %*% solve(t(X) %*% X) %*% t(X)
H
X
X <- seq(1,10, by = 1)
H <- X %*% solve(t(X) %*% X) %*% t(X)
H
X
knitr::opts_chunk$set(
echo = TRUE,
fig.width = 6,
fig.asp = 0.618,
out.width = "70%",
fig.align = "center",
root.dir = "../"
)
pacman::p_load(tidyverse, gglm, skimr, MASS)
data <- read_delim(("companies.txt"), delim = "\t")
data
data <- data %>%
mutate(Employees = as.numeric(Employees))
skim(data)
data %>%
ggplot(aes(MarketValue)) +
geom_histogram(col = "black", fill = "orange") +
labs(
title = "Histogram of the MarketValue",
caption = "The value is concentrated near 0, with
some outliners go beyond 25000"
)
data %>%
ggplot(aes(Assets, MarketValue)) +
geom_point() +
geom_smooth(method=lm) +
labs(
title = "Scatterplot of MarketValue vs Assets",
caption = "There is a cluster for Assets under 10000 millions
with some spread, indicating weak linearity."
)
data %>%
ggplot(aes(Sales, MarketValue)) +
geom_point() +
geom_smooth(method=lm) +
labs(
title = "Scatterplot of MarketValue vs Sales",
caption = "There is a cluster for Sales under 10000 millions
with some spread, indicating weak linearity."
)
data %>%
ggplot(aes(Profits, MarketValue)) +
geom_point() +
geom_smooth(method=lm) +
labs(
title = "Scatterplot of MarketValue vs Profits",
caption = "There is a cluster near 0 Profits, with some negative
values and low spread, indicating some linearity."
)
data %>%
ggplot(aes(CashFlow, MarketValue)) +
geom_point() +
geom_smooth(method=lm) +
labs(
title = "Scatterplot of MarketValue vs CashFlow",
caption = "There is a cluster near 0 CashFlow, with some negative
values and low spread, indicating some linearity."
)
data %>%
ggplot(aes(Employees, MarketValue)) +
geom_point() +
geom_smooth(method=lm) +
labs(
title = "Scatterplot of MarketValue vs Employees",
caption = "There is a cluster for Employees under 100 thousands,
with some curvature, indicating weak linearity."
)
data %>%
ggplot(aes(log(Assets), log(MarketValue))) +
geom_point() +
geom_smooth(method=lm) +
labs(
title = "Scatterplot of MarketValue vs log(Assets)",
caption = "The log scale declusters and improves the linearity between
predictor and response, with some outliners"
)
data %>%
ggplot(aes(log(Sales), log(MarketValue))) +
geom_point() +
geom_smooth(method=lm) +
labs(
title = "Scatterplot of MarketValue vs log(Sales)",
caption = "The log scale declusters and improves the linearity between
predictor and response, with some outliners"
)
data %>%
ggplot(aes(log(Profits), log(MarketValue))) +
geom_point() +
geom_smooth(method=lm) +
labs(
title = "Scatterplot of MarketValue vs log(Profit)",
caption = "There are NaNs produced due to some negative values
in Profits, and there is a slight curvature."
)
data %>%
ggplot(aes(log(CashFlow), log(MarketValue))) +
geom_point() +
geom_smooth(method=lm) +
labs(
title = "Scatterplot of MarketValue vs log(CashFlow)",
caption = "There are NaNs produced due to some negative values
in CashFlow, and there is a slight curvature."
)
data %>%
ggplot(aes(log(Employees), log(MarketValue))) +
geom_point() +
geom_smooth(method=lm) +
labs(
title = "Scatterplot of MarketValue vs log(Employees)",
caption = "The log scale declusters and improves the linearity between
predictor and response, with some outliners"
)
M1 <- lm(MarketValue ~ log(Assets) + log(Sales) + Profits + CashFlow
+ log(Employees), data=data)
summary(M1)
gglm(M1)
bc <- boxcox(M1)
lambda <- bc$x[which.max(bc$y)]
lambda
M2 <- lm(((MarketValue^lambda - 1)/lambda) ~ log(Assets) + log(Sales) + Profits
+ CashFlow + log(Employees), data=data)
summary(M2)
gglm(M2)
new_company <- tibble(
Assets = 1065,
Sales = 642,
Profits = 30,
CashFlow = 59,
Employees = 3.5
)
transform_pred <- predict(M2, newdata=new_company, interval="prediction", level=0.95)
market_pred <- exp(log(transform_pred*lambda + 1)/lambda)
market_pred
setwd("D:/2023-University-of-Adelaide/s1/SM/week7")
knitr::opts_chunk$set(
echo = TRUE,
fig.width = 6,
fig.asp = 0.618,
out.width = "70%",
fig.align = "center",
root.dir = "../"
)
skin
skin <- readxl::read_excel("skin.xlsx")
skin
skin <- skin %>%
mutate(
p = Cases / Population
)
skin %>%
mutate(
p = Cases / Population
)
skin %>%
mutate(
p = Cases / Population
)
skin %>%
mutate(
p = Cases / Population
)
pacman::p_load(tidyverse, gglm, broom, nlme)
skin <- readxl::read_excel("skin.xlsx")
skin
skin %>%
mutate(
p = Cases / Population
)
skin
skin <- skin %>%
mutate(
p = Cases / Population
)
skin
skin %>%
ggplot(aes(Age, p, col = Town)) +
geom_point()
M0 <- glm(
cbind(Cases, Population - Cases) ~ 1,
data = skin,
family = binomial
)
M1 <- glm(
cbind(Cases, Population - Cases) ~ Town,
data = skin,
family = binomial(logit)
)
M2 <- glm(
cbind(Cases, Population - Cases) ~ Age,
data = skin,
family = binomial
)
M3 <- glm(
cbind(Cases, Population - Cases) ~ Town + Age,
data = skin,
family = binomial
)
summary(M3)
summary(M1)
M0 <- glm(
cbind(Cases, Population - Cases) ~ 1,
data = skin,
family = binomial
)
M1 <- glm(
cbind(Cases, Population - Cases) ~ Town,
data = skin,
family = binomial
)
M2 <- glm(
cbind(Cases, Population - Cases) ~ Age,
data = skin,
family = binomial
)
M3 <- glm(
cbind(Cases, Population - Cases) ~ Town + Age,
data = skin,
family = binomial
)
summary(M1)
anova(M0, M1, test='LRT')
anova(M0, M2, test='LRT')
anova(M0, M3, test='LRT')
anova(M0, M4, test='LRT')
AIC(M0, M1, M2, M3)
summary(M3)
skin <-
skin %>%
add_column(
res = residuals(M3, type = "pearson"),
fit = fitted(M3)
)
skin
skin %>%
ggplot(aes(fit, res)) + geom_point()
skin %>%
ggplot(aes(Age, res)) + geom_boxplot()
skin %>%
ggplot(aes(Town, res)) + geom_boxplot()
new_pt <- tibble(Age = "45-54", Town = "Dallas - Fort Worth")
logit_pred <- predict(M3, newdata = new_pt)
logit_pred
pred <- exp(logit_pred) / (1 + exp(logit_pred))
pred
redict(M3, newdata = new_pt, type = "response")
predict(M3, newdata = new_pt, type = "response")
